# OpenClaw CLI 国际化 (i18n) 权威指南

## 1. 核心理念：自动化翻译工作流

为了应对上游代码的频繁更新，并保持 `en.ts` 和 `zh_CN.ts` 的严格对应和有序管理，我们采用**全自动化脚本**工作流。
**核心逻辑**：上游更新代码 -> 拉取最新代码 -> **运行自动化脚本** -> 产出汉化后的代码和结构化的语言包。

## 2. 翻译文件结构规范

为了方便维护几千行的翻译文件，`src/i18n/locales/zh_CN.ts` (及 `en.ts`) 必须遵循**按来源分类**的结构。

### 结构示例

我们不使用扁平的 Key，而是通过**注释区块**来从逻辑上分割文件，保持单文件但清晰可读。

```typescript
export default {
  // =====================================================================================
  // 模块: src/wizard/onboarding.ts
  // 功能: 用户首次安装时的引导流程
  // =====================================================================================
  "Welcome to OpenClaw": "欢迎使用 OpenClaw",
  "Please enter your token": "请输入您的 Token",

  // =====================================================================================
  // 模块: src/commands/doctor.ts
  // 功能: 系统环境诊断工具
  // =====================================================================================
  "Checking dependencies...": "正在检查依赖...",
  "All systems go": "所有系统正常",

  // =====================================================================================
  // 模块: Shared / Utils
  // 功能: 通用工具函数
  // =====================================================================================
  Yes: "是",
  No: "否",
};
```

## 3. 自动化工具 (`scripts/auto-i18n.ts`)

我们将构建一个智能脚本来维护上述结构。

### 脚本功能

1.  **扫描 (Scan)**: 使用 `ts-morph` 扫描 `src/**/*.ts`。
2.  **代码修改 (Codemod)**: 自动将识别到的字符串（如 `console.log("Error")`）替换为 `t("Error")`。
3.  **同步 (Sync)**:
    - 读取 `en.ts` 和 `zh_CN.ts`。
    - 将提取到的 Key 按**文件来源**归类。
    - 在语言文件中生成对应的注释区块（如上所示）。
    - 确保 `en.ts` 和 `zh_CN.ts` 的 Key 顺序和结构完全一致。
4.  **翻译 (Translate)**:
    - 对于 `zh_CN.ts` 中新增的 Key，脚本应支持调用翻译 API (如 DeepSeek/OpenAI) 自动填补，或生成 `[TODO]` 占位符。

## 4. 实施规则细节

### A. 字符串替换规则

- **做**: 包裹面向用户的字符串（日志、提示、错误信息）。
- **不做**: 翻译内部 ID、技术配置 Key、正则表达式、Debug 日志。
- **变量**: 使用 `{{varName}}`。

### B. 处理 `@clack/prompts`

- 对于 `multiselect`，在包装器中使用 `required: false` 来绕过库的内置英文验证错误。

### C. 测试策略

- 在测试文件中 Mock `t` 函数：
  ```typescript
  vi.mock("../i18n/index.js", () => ({
    t: (key: string) => key,
  }));
  ```

### D. 翻译例外规则

- **不翻译**: 特殊名词保留英文，不进行翻译。
  - Skills 名称 (e.g., `browser`, `terminal`)
  - Hooks 名称
  - Model 名称 (e.g., `gpt-4`, `claude-3`)
- **翻译**: 仅翻译这些名词的描述/介绍文案。

## 5. 工作流 (User Story)

1.  **更新代码**: `git pull upstream main`
2.  **执行自动化**: `pnpm i18n:auto-translate` (运行 `scripts/auto-i18n.ts`)
    - 脚本会自动修改代码并更新 `zh_CN.ts`。
3.  **Review**: 检查生成的翻译文件，修正不准确的机器翻译。
4.  **提交**: `git commit`。

## 6. 下一步行动

请使用以下 Prompt 启动 Agent 开发自动化脚本：

```text
请帮我实现 `scripts/auto-i18n.ts` 自动化脚本。
需求：
1. 使用 `ts-morph` 扫描项目。
2. 识别 console.log, throw Error, prompter 等处的字符串并自动替换为 t()。
3. 更新 `src/i18n/locales/zh_CN.ts`，要求输出格式必须包含“按文件来源分类”的注释区块（参考 src/i18n/skill/i18n-implementation-guide.md 中的示例）。
4. 保持 en.ts 和 zh_CN.ts 结构一致。
```
